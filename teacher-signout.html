<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Sign-Out - EZ Sign-Out</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Initialize Firebase -->
  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAEfc8pQ0UHiIm9XQSYbKgI2IhOuP1w0do",
      authDomain: "ez-signout-b1f95.firebaseapp.com",
      projectId: "ez-signout-b1f95",
      storageBucket: "ez-signout-b1f95.firebasestorage.app",
      messagingSenderId: "747672158416",
      appId: "1:747672158416:web:dbf4f85c5acfb5c9785ed5"
    };
  
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <style>
    /* Apple-inspired styling */
    @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600&display=swap');
    
    :root {
      --primary-color: #0071e3; /* Apple blue */
      --secondary-color: #34c759; /* Apple green */
      --accent-color: #FF9500; /* Apple orange */
      --danger-color: #ff3b30; /* Apple red */
      --text-color: #1d1d1f; /* Apple dark gray */
      --secondary-text-color: #86868b; /* Apple medium gray */
      --background-color: #ffffff;
      --background-secondary: #f5f5f7; /* Apple light gray */
      --border-color: #d2d2d7;
      --class-12k-color: #5ac8fa; /* Apple blue */
      --class-13w-color: #af52de; /* Apple purple */
      --class-13b-color: #ff9500; /* Apple orange */
      --border-radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      --button-radius: 20px;
      --animation-duration: 0.3s;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-color);
      background-color: var(--background-color);
      margin: 0;
      padding: 0;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }
    
    .wrapper {
      max-width: 1100px;
      margin: 0 auto;
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    h1 {
      font-size: 32px;
      font-weight: 600;
      letter-spacing: -0.015em;
      margin-bottom: 24px;
    }
    
    h2 {
      font-size: 24px;
      font-weight: 500;
      letter-spacing: -0.012em;
      margin-bottom: 16px;
      margin-top: 24px;
    }
    
    h3 {
      font-size: 20px;
      font-weight: 500;
      letter-spacing: -0.01em;
      margin-bottom: 12px;
    }
    
    /* Container styling */
    .container {
      background-color: var(--background-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 30px;
      margin-bottom: 20px;
      width: 100%;
      position: relative;
    }
    
    /* Back button */
    .back-button {
      display: inline-flex;
      align-items: center;
      background-color: var(--background-secondary);
      color: var(--text-color);
      border-radius: var(--button-radius);
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
      margin-bottom: 20px;
      transition: all var(--animation-duration);
    }
    
    .back-button:hover {
      background-color: #eaeaea;
      transform: translateY(-1px);
    }
    
    .back-button::before {
      content: '‚Üê';
      margin-right: 8px;
    }
    
    /* Form styling */
    .form-section {
      margin-bottom: 30px;
      background-color: var(--background-secondary);
      border-radius: var(--border-radius);
      padding: 24px;
    }
    
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      flex: 1;
      min-width: 250px;
      display: flex;
      flex-direction: column;
    }
    
    label {
      font-size: 14px;
      margin-bottom: 8px;
      color: var(--secondary-text-color);
    }
    
    select, input {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      background-color: white;
      outline: none;
      transition: border-color var(--animation-duration), box-shadow var(--animation-duration);
    }
    
    select:focus, input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.15);
    }
    
    /* Class filter buttons */
    .class-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .class-filter {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      color: white;
      cursor: pointer;
      transition: all var(--animation-duration);
      border: none;
    }
    
    .class-filter:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .class-filter.active {
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.7);
    }
    
    .class-filter.class-12k {
      background-color: var(--class-12k-color);
    }
    
    .class-filter.class-13w {
      background-color: var(--class-13w-color);
    }
    
    .class-filter.class-13b {
      background-color: var(--class-13b-color);
    }
    
    .class-filter.all {
      background-color: var(--text-color);
    }
    
    /* Button styling */
    button {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--background-secondary);
      color: var(--text-color);
      border: none;
      border-radius: var(--button-radius);
      padding: 12px 20px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--animation-duration);
      margin: 4px;
      outline: none;
    }
    
    button:hover {
      background-color: #eaeaea;
      transform: translateY(-1px);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    .primary-button {
      background-color: var(--primary-color);
      color: white;
    }
    
    .primary-button:hover {
      background-color: #0077ed;
    }
    
    .secondary-button {
      background-color: var(--secondary-color);
      color: white;
    }
    
    .secondary-button:hover {
      background-color: #30b350;
    }
    
    /* Student list styling */
    .student-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    
    .student-card {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 16px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      transition: all var(--animation-duration);
      position: relative;
      overflow: hidden;
    }
    
    .student-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
    }
    
    .student-card.class-12k::before {
      background-color: var(--class-12k-color);
    }
    
    .student-card.class-13w::before {
      background-color: var(--class-13w-color);
    }
    
    .student-card.class-13b::before {
      background-color: var(--class-13b-color);
    }
    
    .student-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }
    
    .student-name {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .student-class {
      font-size: 14px;
      color: var(--secondary-text-color);
      margin-bottom: 16px;
    }
    
    .student-status {
      font-size: 14px;
      margin-bottom: 16px;
    }
    
    .signed-in {
      color: var(--secondary-color);
      font-weight: 500;
    }
    
    .signed-out {
      color: var(--danger-color);
      font-weight: 500;
    }
    
    .student-actions {
      margin-top: auto;
      display: flex;
      gap: 8px;
    }
    
    .student-actions button {
      flex: 1;
      font-size: 14px;
      padding: 8px 12px;
    }
    
    /* Duration options */
    .duration-options {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    /* Confirmation dialog */
    .confirmation-dialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity var(--animation-duration), visibility var(--animation-duration);
    }
    
    .confirmation-dialog.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .dialog-content {
      background-color: var(--background-color);
      border-radius: var(--border-radius);
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .dialog-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    
    .dialog-message {
      margin-bottom: 24px;
    }
    
    .dialog-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    
    /* Utilities */
    .hidden {
      display: none !important;
    }
    
    /* Responsive styles */
    @media (max-width: 767px) {
      .wrapper {
        padding: 16px;
      }
      
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 28px;
      }
      
      .form-section {
        padding: 16px;
      }
      
      .student-list {
        grid-template-columns: 1fr;
      }
      
      .duration-options {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="container">
      <a href="teacher-entry.html" class="back-button">Back to Teacher Options</a>
      
      <h1>Teacher Sign-Out</h1>
      
      <!-- Student Selection Form -->
      <div class="form-section">
        <h2>Sign-Out Students</h2>
        
        <div class="class-filters">
          <button class="class-filter all active" onclick="filterStudentsByClass('all')">All Classes</button>
          <button class="class-filter class-12k" onclick="filterStudentsByClass('12K')">Class 12K</button>
          <button class="class-filter class-13w" onclick="filterStudentsByClass('13W')">Class 13W</button>
          <button class="class-filter class-13b" onclick="filterStudentsByClass('13B')">Class 13B</button>
        </div>
        
        <input type="text" id="student-search" placeholder="Search students..." onkeyup="searchStudents()">
        
        <div class="student-list" id="student-list">
          <!-- Student cards will be dynamically added here -->
        </div>
      </div>
      
      <!-- Sign-Out Form (shown when a student is selected) -->
      <div class="form-section hidden" id="sign-out-form">
        <h2>Sign-Out <span id="selected-student-name">Student</span></h2>
        <p id="selected-student-class" style="margin-bottom: 20px; color: var(--secondary-text-color);"></p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="sign-out-date">Date</label>
            <input type="date" id="sign-out-date">
          </div>
          <div class="form-group">
            <label for="sign-out-time">Time</label>
            <input type="time" id="sign-out-time">
          </div>
        </div>
        
        <h3>Duration</h3>
        <div class="duration-options">
          <button class="primary-button" onclick="selectDuration('day')">For Today</button>
          <button class="secondary-button" onclick="selectDuration('week')">Until End of Week</button>
          <button onclick="selectDuration('recurring')">Weekly Recurring</button>
        </div>
        
        <div style="margin-top: 24px; display: flex; justify-content: flex-end; gap: 12px;">
          <button onclick="cancelSignOut()">Cancel</button>
          <button class="primary-button" onclick="confirmSignOut()">Sign Out Student</button>
        </div>
      </div>
    </div>
    
    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmation-dialog">
      <div class="dialog-content">
        <div class="dialog-title">Confirm Sign-Out</div>
        <div class="dialog-message" id="confirmation-message">
          Are you sure you want to sign out this student?
        </div>
        <div class="dialog-buttons">
          <button onclick="hideConfirmationDialog()">Cancel</button>
          <button class="primary-button" onclick="processSignOut()">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Data storage
    let userData = {
      signOutRecords: [],
      signInRecords: []
    };
    
    let selectedStudent = null;
    let selectedClass = "all";
    let selectedDuration = "day";
    
    // Initialize the app
    async function init() {
      try {
        // Load data from Firestore
        const docRef = db.collection('signOutApp').doc('userData');
        const doc = await docRef.get();
        
        if (doc.exists) {
          const data = doc.data();
          
          // Convert string dates back to Date objects
          if (data.signOutRecords) {
            data.signOutRecords.forEach(record => {
              record.date = new Date(record.date);
              if (record.endDate) record.endDate = new Date(record.endDate);
            });
          }
          
          if (data.signInRecords) {
            data.signInRecords.forEach(record => {
              record.date = new Date(record.date);
            });
          }
          
          userData = data;
          
          // Load students
          loadStudents();
          
          // Set up real-time updates
          setupRealtimeUpdates();
          
          // Set default date and time to now
          const now = new Date();
          const dateInput = document.getElementById("sign-out-date");
          const timeInput = document.getElementById("sign-out-time");
          
          // Format date as YYYY-MM-DD for input
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          dateInput.value = `${year}-${month}-${day}`;
          
          // Format time as HH:MM for input
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          timeInput.value = `${hours}:${minutes}`;
        } else {
          // Initialize with empty data if document doesn't exist
          userData = {
            signOutRecords: [],
            signInRecords: []
          };
          
          // Create the document
          await docRef.set(userData);
          loadStudents();
        }
      } catch (error) {
        console.error("Error loading data:", error);
        
        // Fallback to empty data
        userData = {
          signOutRecords: [],
          signInRecords: []
        };
        
        loadStudents();
      }
    }
    
    // Load students from records
    function loadStudents() {
      const studentList = document.getElementById("student-list");
      studentList.innerHTML = "";
      
      // Get unique students with their classes
      const students = {};
      
      // Collect all students from sign-out and sign-in records
      userData.signOutRecords.forEach(record => {
        if (record.user && record.class) {
          if (!students[record.user]) {
            students[record.user] = {
              name: record.user,
              class: record.class
            };
          }
        }
      });
      
      userData.signInRecords.forEach(record => {
        if (record.user && record.class) {
          if (!students[record.user]) {
            students[record.user] = {
              name: record.user,
              class: record.class
            };
          }
        }
      });
      
      // Convert to array and sort by name
      const studentArray = Object.values(students);
      studentArray.sort((a, b) => a.name.localeCompare(b.name));
      
      // Check current sign-out status for each student
      const now = new Date();
      
      studentArray.forEach(student => {
        // Check if student is currently signed out
        const isSignedOut = userData.signOutRecords.some(record => 
          record.user === student.name && 
          record.date <= now && 
          (!record.endDate || record.endDate >= now) && 
          !record.signedBackIn
        );
        
        student.isSignedOut = isSignedOut;
      });
      
      // Apply class filter if not "all"
      const filteredStudents = selectedClass === "all" 
        ? studentArray 
        : studentArray.filter(student => student.class === selectedClass);
      
      // Create student cards
      if (filteredStudents.length === 0) {
        studentList.innerHTML = '<p style="text-align: center; color: var(--secondary-text-color); padding: 20px;">No students found. Students will appear here after they sign in for the first time.</p>';
        return;
      }
      
      filteredStudents.forEach(student => {
        createStudentCard(student);
      });
    }
    
    // Create a student card
    function createStudentCard(student) {
      const studentList = document.getElementById("student-list");
      
      const card = document.createElement("div");
      card.className = `student-card class-${student.class.toLowerCase()}`;
      card.dataset.name = student.name.toLowerCase();
      card.dataset.class = student.class;
      
      const statusText = student.isSignedOut ? "Currently Signed Out" : "Present";
      const statusClass = student.isSignedOut ? "signed-out" : "signed-in";
      
      card.innerHTML = `
        <div class="student-name">${student.name}</div>
        <div class="student-class">Class: ${student.class}</div>
        <div class="student-status">Status: <span class="${statusClass}">${statusText}</span></div>
        <div class="student-actions">
          ${student.isSignedOut 
            ? `<button class="secondary-button" onclick="signInStudent('${student.name}', '${student.class}')">Sign In</button>` 
            : `<button class="primary-button" onclick="selectStudent('${student.name}', '${student.class}')">Sign Out</button>`}
        </div>
      `;
      
      studentList.appendChild(card);
    }
    
    // Filter students by class
    function filterStudentsByClass(className) {
      selectedClass = className;
      
      // Update active button
      document.querySelectorAll('.class-filter').forEach(btn => {
        btn.classList.remove('active');
      });
      
      document.querySelector(`.class-filter.${className === 'all' ? 'all' : 'class-' + className.toLowerCase()}`).classList.add('active');
      
      // Reload student list
      loadStudents();
    }
    
    // Search students
    function searchStudents() {
      const searchTerm = document.getElementById("student-search").value.toLowerCase();
      const studentCards = document.querySelectorAll(".student-card");
      
      studentCards.forEach(card => {
        const studentName = card.dataset.name;
        
        if (studentName.includes(searchTerm)) {
          card.style.display = "";
        } else {
          card.style.display = "none";
        }
      });
    }
    
    // Select a student to sign out
    function selectStudent(name, classname) {
      selectedStudent = { name, class: classname };
      
      // Show sign-out form
      document.getElementById("sign-out-form").classList.remove("hidden");
      
      // Set student info
      document.getElementById("selected-student-name").textContent = name;
      document.getElementById("selected-student-class").textContent = `Class: ${classname}`;
      
      // Scroll to form
      document.getElementById("sign-out-form").scrollIntoView({ behavior: 'smooth' });
    }
    
    // Cancel sign-out form
    function cancelSignOut() {
      document.getElementById("sign-out-form").classList.add("hidden");
      selectedStudent = null;
    }
    
    // Select duration
    function selectDuration(duration) {
      selectedDuration = duration;
      
      // Update button styles
      document.querySelectorAll('.duration-options button').forEach(btn => {
        btn.classList.remove('primary-button', 'secondary-button');
      });
      
      // Highlight selected button
      const buttons = document.querySelectorAll('.duration-options button');
      if (duration === 'day') {
        buttons[0].classList.add('primary-button');
      } else if (duration === 'week') {
        buttons[1].classList.add('secondary-button');
      } else {
        buttons[2].classList.add('secondary-button');
      }
    }
    
    // Show confirmation dialog
    function confirmSignOut() {
      const dateInput = document.getElementById("sign-out-date").value;
      const timeInput = document.getElementById("sign-out-time").value;
      
      if (!dateInput || !timeInput) {
        alert("Please select both date and time.");
        return;
      }
      
      if (!selectedStudent) {
        alert("Please select a student.");
        return;
      }
      
      // Set confirmation message
      let durationText = "";
      switch (selectedDuration) {
        case "day":
          durationText = "for today";
          break;
        case "week":
          durationText = "until the end of the week";
          break;
        case "recurring":
          durationText = "weekly (recurring)";
          break;
      }
      
      const signOutDate = new Date(`${dateInput}T${timeInput}`);
      const formattedDate = signOutDate.toLocaleDateString();
      const formattedTime = signOutDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      document.getElementById("confirmation-message").innerHTML = `
        <p>You are about to sign out <strong>${selectedStudent.name}</strong> from Class ${selectedStudent.class}:</p>
        <p>Date: ${formattedDate}<br>
        Time: ${formattedTime}<br>
        Duration: ${durationText}</p>
        <p>Do you want to continue?</p>
      `;
      
      // Show dialog
      document.getElementById("confirmation-dialog").classList.add("visible");
    }
    
    // Hide confirmation dialog
    function hideConfirmationDialog() {
      document.getElementById("confirmation-dialog").classList.remove("visible");
    }
    
    // Process sign-out
    function processSignOut() {
      const dateInput = document.getElementById("sign-out-date").value;
      const timeInput = document.getElementById("sign-out-time").value;
      const signOutDate = new Date(`${dateInput}T${timeInput}`);
      
      let endDate = null;
      const isRecurring = selectedDuration === "recurring";
      
      if (selectedDuration === "day") {
        // Set end date to end of the selected day
        endDate = new Date(signOutDate);
        endDate.setHours(23, 59, 59, 999);
      } else if (selectedDuration === "week" || selectedDuration === "recurring") {
        // Set end date to end of the week
        endDate = getEndOfWeek(signOutDate);
      }
      
      // Create record
      const record = {
        user: selectedStudent.name,
        class: selectedStudent.class,
        date: signOutDate,
        endDate: endDate,
        signedBackIn: false,
        isRecurring: isRecurring
      };
      
      // Add to records
      userData.signOutRecords.push(record);
      
      // If recurring, create additional weekly events
      if (isRecurring) {
        // Create 10 weekly recurring events
        for (let i = 1; i <= 10; i++) {
          const nextDate = new Date(signOutDate);
          nextDate.setDate(nextDate.getDate() + (i * 7)); // Add 7 days for each week
          
          let nextEndDate = null;
          if (endDate) {
            nextEndDate = new Date(nextDate);
            nextEndDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());
          }
          
          const recurringRecord = {
            user: selectedStudent.name,
            class: selectedStudent.class,
            date: nextDate,
            endDate: nextEndDate,
            signedBackIn: false,
            isRecurring: true
          };
          
          userData.signOutRecords.push(recurringRecord);
        }
      }
      
      // Save to Firebase
      saveData();
      
      // Hide dialog and form
      hideConfirmationDialog();
      cancelSignOut();
      
      // Reload student list
      loadStudents();
      
      // Show success message
      alert(`${selectedStudent.name} has been signed out successfully.`);
    }
    
    // Sign in a student
    function signInStudent(name, classname) {
      const now = new Date();
      
      // Find active sign-out records for the user
      let foundActive = false;
      userData.signOutRecords.forEach(record => {
        if (record.user === name && 
            record.date <= now && 
            (!record.endDate || record.endDate >= now) && 
            !record.signedBackIn) {
          record.signedBackIn = true;
          foundActive = true;
        }
      });
      
      if (foundActive) {
        // Add sign-in record
        userData.signInRecords.push({
          user: name,
          class: classname,
          date: now
        });
        
        // Save to Firebase
        saveData();
        
        // Reload student list
        loadStudents();
        
        alert(`${name} has been signed back in successfully.`);
      } else {
        alert("No active sign-out record found for this student.");
      }
    }
    
    // Get the end of the week date
    function getEndOfWeek(date) {
      const result = new Date(date);
      result.setDate(date.getDate() + (6 - date.getDay()));
      result.setHours(23, 59, 59, 999);
      return result;
    }
    
    // Save data to Firestore
    function saveData() {
      try {
        // Create a serializable copy
        const serializableData = JSON.parse(JSON.stringify(userData));
        
        // Save to Firestore
        db.collection('signOutApp').doc('userData').set(serializableData);
      } catch (error) {
        console.error("Error saving data:", error);
      }
    }
    
    // Set up real-time updates
    function setupRealtimeUpdates() {
      db.collection('signOutApp').doc('userData')
        .onSnapshot((doc) => {
          if (doc.exists) {
            const data = doc.data();
            
            // Convert string dates back to Date objects
            if (data.signOutRecords) {
              data.signOutRecords.forEach(record => {
                record.date = new Date(record.date);
                if (record.endDate) record.endDate = new Date(record.endDate);
              });
            }
            
            if (data.signInRecords) {
              data.signInRecords.forEach(record => {
                record.date = new Date(record.date);
              });
            }
            
            // Update our userData with the new data
            userData = data;
            
            // Update the UI only if not in the middle of signing out
            if (!selectedStudent) {
              loadStudents();
            }
          }
        });
    }
    
    // Initialize on page load
    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
